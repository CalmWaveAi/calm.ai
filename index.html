<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CalmMind AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  height: 100vh;
  background: linear-gradient(180deg, #e6f2f1, #cfe8e6);
  font-family: "Segoe UI", sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.container {
  text-align: center;
  width: 90%;
  max-width: 420px;
}

.icon {
  font-size: 90px;
  margin-bottom: 20px;
  animation: float 6s ease-in-out infinite;
}

@keyframes float {
  0%   { transform: translateY(0px); }
  50%  { transform: translateY(-18px); }
  100% { transform: translateY(0px); }
}

textarea {
  width: 100%;
  height: 120px;
  border-radius: 30px;
  border: none;
  padding: 20px;
  font-size: 16px;
  outline: none;
  resize: none;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

button {
  margin-top: 20px;
  width: 100%;
  padding: 16px;
  border-radius: 30px;
  border: none;
  background: #6bbfb8;
  color: white;
  font-size: 18px;
  cursor: pointer;
}

button:hover {
  background: #58a9a3;
}

.status {
  margin-top: 15px;
  font-size: 14px;
  color: #335;
}
</style>
</head>

<body>

<div class="container">
  <div class="icon" id="icon">ðŸŒ¿</div>

  <textarea id="feelings" placeholder="Tell me how you feel right now..."></textarea>

  <button onclick="startSession()">Calm Me</button>

  <div class="status" id="status"></div>
</div>

<script>
let audioCtx;
let noiseSource;
let isActive = false;

// ðŸŒ¿ Start calm session
function startSession() {
  if (isActive) return;
  isActive = true;

  const text = document.getElementById("feelings").value.toLowerCase();
  const status = document.getElementById("status");
  status.innerText = "The AI is gently speaking to youâ€¦";

  // ðŸŒ™ Generate calming story
  let story = "Take a slow breath. ";
  story += "You are in a peaceful place where nothing is expected of you. ";

  if (text.includes("anxious") || text.includes("panic")) {
    story += "Your thoughts begin to slow, and your breathing becomes steady and calm. ";
  } else if (text.includes("sad")) {
    story += "Gentle warmth surrounds you, reminding you that you are not alone. ";
  } else if (text.includes("tired") || text.includes("sleep")) {
    story += "Your body feels heavy and relaxed, ready to rest deeply. ";
  } else {
    story += "Everything around you moves softly and without urgency. ";
  }

  story += "You are safe. You are allowed to relax.";

  // ðŸ—£ï¸ AI Voice (built-in, human-like)
  const speech = new SpeechSynthesisUtterance(story);
  speech.rate = 0.75;
  speech.pitch = 0.9;
  speech.volume = 1;

  speech.onend = () => {
    status.innerText = "Now resting with calming nature sounds ðŸŒ²";
    startNatureSound();
  };

  speechSynthesis.cancel();
  speechSynthesis.speak(speech);
}

// ðŸŒ² Procedural nature sound AFTER voice
function startNatureSound() {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  const bufferSize = 2 * audioCtx.sampleRate;
  const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const data = noiseBuffer.getChannelData(0);

  let last = 0;
  for (let i = 0; i < bufferSize; i++) {
    const rnd = Math.random() * 2 - 1;
    data[i] = (last + 0.02 * rnd) / 1.02;
    last = data[i];
  }

  noiseSource = audioCtx.createBufferSource();
  noiseSource.buffer = noiseBuffer;
  noiseSource.loop = true;

  const gain = audioCtx.createGain();
  gain.gain.value = 0.08;

  noiseSource.connect(gain).connect(audioCtx.destination);
  noiseSource.start();

  // stop after 3 hours
  setTimeout(endSession, 10800000);
}

// ðŸŒ™ Stop everything
function endSession() {
  speechSynthesis.cancel();
  if (noiseSource) noiseSource.stop();
  if (audioCtx) audioCtx.close();
  isActive = false;
  document.getElementById("status").innerText = "Session ended ðŸŒ™";
}
</script>

</body>
</html>
