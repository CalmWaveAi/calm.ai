<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Calm AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#0c1714;
  color:#e7f5f2;
  font-family:system-ui,-apple-system,Segoe UI,sans-serif;
}
.app {
  width:90%;
  max-width:900px;
  padding:40px;
  border-radius:32px;
  background:rgba(255,255,255,0.06);
  backdrop-filter:blur(22px);
  text-align:center;
}
textarea {
  width:100%;
  height:120px;
  border-radius:24px;
  border:none;
  padding:18px;
  background:rgba(255,255,255,.12);
  color:#e7f5f2;
  resize:none;
  font-size:16px;
}
button {
  margin-top:28px;
  padding:18px 42px;
  border-radius:999px;
  border:none;
  background:#6fd3c4;
  font-size:18px;
  color:#06332c;
  cursor:pointer;
}
.orb {
  width:180px;
  height:180px;
  margin:0 auto 30px;
  border-radius:50%;
  background:radial-gradient(circle at top,#b7fff3,#49bfb0);
  animation:float 14s ease-in-out infinite;
  box-shadow:0 0 120px rgba(111,211,196,.6);
}
@keyframes float {
  0% { transform:translateY(0) scale(1); }
  50% { transform:translateY(-20px) scale(1.04); }
  100% { transform:translateY(0) scale(1); }
}
.status {
  margin-top:18px;
  font-size:14px;
  color:#a8cfc7;
}
</style>
</head>
<body>

<div class="app">
  <div class="orb" id="orb"></div>
  <h1>Begin Calm</h1>
  <textarea id="emotion" placeholder="How are you feeling right now?"></textarea>
  <br>
  <button id="start">Start Session</button>
  <div class="status" id="status"></div>
</div>

<script>
let ctx;
let interval;

/* -------- EMOTION DETECTION -------- */
function detectEmotion(text){
  text = text.toLowerCase();
  if(text.includes("stress") || text.includes("anxious")) return "anxiety";
  if(text.includes("sad") || text.includes("heavy")) return "sad";
  if(text.includes("sleep") || text.includes("tired")) return "sleep";
  return "calm";
}

/* -------- START SESSION -------- */
document.getElementById("start").onclick = () => {
  if(ctx) ctx.close();
  clearInterval(interval);

  ctx = new (window.AudioContext || window.webkitAudioContext)();
  const mood = detectEmotion(emotion.value);

  generateSoundscape(mood);
  animateOrb(mood);

  status.innerText = "A unique calm space is formingâ€¦";
};

/* -------- SOUND ENGINE -------- */
function generateSoundscape(mood){
  const profiles = {
    anxiety: { base:120, speed:5000, volume:0.03 },
    sad:     { base:90,  speed:7000, volume:0.025 },
    sleep:   { base:70,  speed:9000, volume:0.02 },
    calm:    { base:100, speed:6000, volume:0.028 }
  };

  const p = profiles[mood];

  // Pads
  for(let i=0;i<3;i++){
    const osc = ctx.createOscillator();
    osc.type = "sine";
    osc.frequency.value = p.base * (1 + i*0.12 + Math.random()*0.04);

    const gain = ctx.createGain();
    gain.gain.value = p.volume;

    osc.connect(gain).connect(ctx.destination);
    osc.start();
  }

  // Air texture
  const buffer = ctx.createBuffer(1, ctx.sampleRate*2, ctx.sampleRate);
  const data = buffer.getChannelData(0);
  for(let i=0;i<data.length;i++){
    data[i] = (Math.random()*2-1)*0.03;
  }

  const noise = ctx.createBufferSource();
  noise.buffer = buffer;
  noise.loop = true;

  const filter = ctx.createBiquadFilter();
  filter.type = "lowpass";
  filter.frequency.value = p.base * 6;

  const nGain = ctx.createGain();
  nGain.gain.value = p.volume;

  noise.connect(filter).connect(nGain).connect(ctx.destination);
  noise.start();

  // Slow swells
  interval = setInterval(() => {
    const osc = ctx.createOscillator();
    osc.type = "sine";
    osc.frequency.value = p.base + Math.random()*30;

    const gain = ctx.createGain();
    gain.gain.setValueAtTime(0, ctx.currentTime);
    gain.gain.linearRampToValueAtTime(p.volume*2, ctx.currentTime+3);
    gain.gain.linearRampToValueAtTime(0, ctx.currentTime+9);

    osc.connect(gain).connect(ctx.destination);
    osc.start();
    osc.stop(ctx.currentTime+9);
  }, p.speed);
}

/* -------- VISUAL RESPONSE -------- */
function animateOrb(mood){
  const orb = document.getElementById("orb");
  const speeds = {
    anxiety: "10s",
    sad: "14s",
    sleep: "20s",
    calm: "12s"
  };
  orb.style.animationDuration = speeds[mood];
}
</script>
</body>
</html>
